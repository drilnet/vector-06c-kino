;
	PUBLIC	CINEMA, CURSYX, REVERS, RETURN
	PUBLIC	PKADR, KKADR, PRNTK
	PUBLIC	ERRORR, ERRORS
;
	EXTRN	KODKEY, KEYJOY, PAUSE, CURBOX
	EXTRN	NEWPAL, PALSPR, SPR, STRCUR
	EXTRN	NARCUR, CURS1, CURS2, INKEY
	EXTRN	PALIT0, PRER1, PRER2

	EXTRN	@TREK, LIST, READ, M1, @GOTR
	EXTRN	SAVE
;
	EXTRN	@EXIT, @DRVOF, @DRVON
	EXTRN	@CLS, @SCOL, @GCOL, @PLTR
	EXTRN	@DECA, @WRITE, @PLOTS, @BOXF
	EXTRN	@DESPR
;
;--------------------------------
CINEMA:
;
	LXI	D,SPR
	CALL	@DESPR
	CALL	PRNMNU
	CALL	PRNMP
	CALL	PRNTK
	CALL	PRNPK
	CALL	PRNKK
	CALL	PRNREV
	LDA	REVERS
	ANA	A
	LXI	D,MRON
	JNZ	NARREV
	LXI	D,MROFF
NARREV: CALL	PRESS
;
	LXI	D,PALSPR
	CALL	NEWPAL
;--------------------------------οσξοχξοκ γιλμ----------------
LOOP1:	CALL	PERCUR
;
KADRTM: LXI	H,00DDDH
	LXI	D,01AEAH
	CALL	CURBOX
	ANA	A
	JZ	KADRTP
	LDA	@TREK
	ANA	A
	JZ	LOOP1
	DCR	A
	STA	@TREK
	LXI	D,MTKM
	CALL	PRESS
	LXI	H,@TREK
	LXI	D,COLTK
	CALL	KEYM
	CALL	PRNMP
	CALL	PRNCUR2
	LXI	H,PALSPR+15
	SHLD	M1+1
	CALL	CLSBOX
	JMP	LIST
;
KADRTP: LXI	H,03DDDH
	LXI	D,04AEAH
	CALL	CURBOX
	ANA	A
	JZ	KADRPM
	LDA	@TREK
	CPI	164
	JZ	LOOP1
	INR	A
	STA	@TREK
	LXI	D,MTKP
	CALL	PRESS
	LXI	H,@TREK
	LXI	D,COLTK
	CALL	KEYP
	CALL	PRNMP
	CALL	PRNCUR2
	LXI	H,PALSPR+15
	SHLD	M1+1
	CALL	CLSBOX
	JMP	LIST
;
KADRPM: LXI	H,00DADH
	LXI	D,01ABAH
	CALL	CURBOX
	ANA	A
	JZ	KADRPP
	LDA	PKADR
	ANA	A
	JZ	LOOP1
	DCR	A
	STA	PKADR
	CALL	COLPK
	LXI	D,MPKM
	CALL	PRESS
	LXI	H,PKADR
	LXI	D,COLPK
	CALL	KEYM
	CALL	PRNMP
	JMP	LOOP1
;
KADRPP: LXI	H,03DADH
	LXI	D,04ABAH
	CALL	CURBOX
	ANA	A
	JZ	KADRKM
	LDA	PKADR
	CPI	164
	JZ	LOOP1
	INR	A
	STA	PKADR
	CALL	COLPK
	LXI	D,MPKP
	CALL	PRESS
	LXI	H,PKADR
	LXI	D,COLPK
	CALL	KEYP
	CALL	PRNMP
	JMP	LOOP1
;
KADRKM: LXI	H,00D7DH
	LXI	D,01A8AH
	CALL	CURBOX
	ANA	A
	JZ	KADRKP
	LDA	KKADR
	ANA	A
	JZ	LOOP1
	DCR	A
	STA	KKADR
	CALL	COLKK
	LXI	D,MKKM
	CALL	PRESS
	LXI	H,KKADR
	LXI	D,COLKK
	CALL	KEYM
	CALL	PRNMP
	JMP	LOOP1
;
KADRKP: LXI	H,03D7DH
	LXI	D,04A8AH
	CALL	CURBOX
	ANA	A
	JZ	REVON
	LDA	KKADR
	CPI	164
	JZ	LOOP1
	INR	A
	STA	KKADR
	CALL	COLKK
	LXI	D,MKKP
	CALL	PRESS
	LXI	H,KKADR
	LXI	D,COLKK
	CALL	KEYP
	CALL	PRNMP
	JMP	LOOP1
;
REVON:	LXI	H,00D55H
	LXI	D,02A62H
	CALL	CURBOX
	ANA	A
	JZ	REVOFF
	CALL	PRNREV
	LXI	D,MRON
	CALL	PRESS
	MVI	A,0FFH
	STA	REVERS
	JMP	LOOP1
;
REVOFF: LXI	H,03555H
	LXI	D,05A62H
	CALL	CURBOX
	ANA	A
	JZ	FREAD
	CALL	PRNREV
	LXI	D,MROFF
	CALL	PRESS
	XRA	A
	STA	REVERS
	JMP	LOOP1
;
FREAD:	LXI	H,06F6DH
	LXI	D,0F07AH
	CALL	CURBOX
	ANA	A
	JZ	FSAVE
	LXI	D,MFREAD
	CALL	PRESS
	CALL	PRNCUR2
	MVI	A,05FH
	CALL	@SCOL
	LXI	D,MSTOP
	CALL	@WRITE
	DI
	LXI	D,PRER1
	CALL	@DRVOF
	DI
	XRA	A
	LXI	D,PRER2
	CALL	@DRVON
	LXI	H,PALSPR+15
	SHLD	M1+1
	CALL	CLSBOX
	JMP	READ
;
FSAVE:	LXI	H,06F55H
	LXI	D,0F062H
	CALL	CURBOX
	ANA	A
	JZ	KLOAD
	LXI	D,MFSAVE
	CALL	PRESS
	CALL	PRNCUR2
	MVI	A,05FH
	CALL	@SCOL
;	LXI	D,MSTOP
;	CALL	@WRITE
;	DI
;	LXI	D,PRER1
;	CALL	@DRVOF
	DI
;	XRA	A
;	LXI	D,PRER2
;	CALL	@DRVON
;	LXI	H,PALSPR+15
;	SHLD	M1+1
	CALL	CLSBOX
	JMP	SAVE
;
KLOAD:
;
KSAVE:
;
EXIT:	LXI	H,06F0DH
	LXI	D,0F01AH
	CALL	CURBOX
	ANA	A
	JZ	LOOP1
	LXI	D,MEXIT
	CALL	PRESS
	LXI	D,PALIT0
	CALL	NEWPAL
	CALL	@GOTR
	CALL	@CLS
	CALL	@EXIT
	JMP	00000H
;
;--------------------------------πεςενεύεξιε λυςσοςα----------------
PERCUR: CALL	PRNCUR1
CURS:	CALL	INKEY
	HLT
;
CURSN:	LDA	KODKEY
	ANI	10000000B
	JNZ	CURSP
	LDA	CURSYX
	CPI	8
	JZ	CURSP
	CALL	STRCUR
	LXI	H,CURSYX
	DCR	M
	DCR	M
	CALL	PRNCUR1
;
CURSP:	LDA	KODKEY
	ANI	01000000B
	JNZ	CURSW
	LDA	CURSYX+1
	CPI	248
	JZ	CURSW
	CALL	STRCUR
	LXI	H,CURSYX+1
	INR	M
	INR	M
	CALL	PRNCUR1
;
CURSW:	LDA	KODKEY
	ANI	00100000B
	JNZ	CURSL
	LDA	CURSYX
	CPI	250
	JZ	CURSL
	CALL	STRCUR
	LXI	H,CURSYX
	INR	M
	INR	M
	CALL	PRNCUR1
;
CURSL:	LDA	KODKEY
	ANI	00010000B
	JNZ	CURSE
	LDA	CURSYX+1
	ANA	A
	JZ	CURSE
	CALL	STRCUR
	LXI	H,CURSYX+1
	DCR	M
	DCR	M
	CALL	PRNCUR1
;
CURSE:	LDA	KODKEY
	CPI	11111011B
	JNZ	CURS
	JMP	STRCUR
;
;--------------------------------
PRNCUR2:
	LXI	B,CURS2
	JMP	PRNCUR
PRNCUR1:
	LXI	B,CURS1
PRNCUR: LHLD	CURSYX
	XCHG
	JMP	NARCUR
;----------------
RETURN:
	DI
	LXI	D,PRER2
	CALL	@DRVOF
	DI
	XRA	A
	LXI	D,PRER1
	CALL	@DRVON
;
	LHLD	M1+1
	LXI	D,-15
	DAD	D
	XCHG
	CALL	@PLTR
;
	CALL	STRCUR
	CALL	PRNMNU
	MVI	A,5
	CALL	@GCOL
	MVI	A,25
	CALL	PAUSE
	LXI	D,00911H
	CALL	@PLOTS
	LXI	D,05E49H
	CALL	@BOXF
;
	JMP	LOOP1
;--------------------------------οϋιβλα----------------
ERRORR: LXI	D,MERRORR
	CALL	@WRITE
	LDA	@TREK
	JMP	@DECA
;----------------
ERRORS: LXI	D,MERRORS
	CALL	@WRITE
	LDA	@TREK
	JMP	@DECA
;--------------------------------οώιστλα όλςαξώιλα----------------
CLSBOX: LXI	D,02000H
	LXI	B,-06000H
	MVI	H,08BH
CLSB1:	XRA	A
	MVI	L,080H
CLSB2:	MOV	M,A
	DAD	D
	MOV	M,A
	DAD	D
	MOV	M,A
	DAD	D
	MOV	M,A
	DAD	B
	INR	L
	JNZ	CLSB2
	INR	H
	MVI	A,09FH
	CMP	H
	JNZ	CLSB1
	RET
;
;--------------------------------ξαφατιε----------------
PRESS:	PUSH	D
		MVI	A,050H
		CALL	@SCOL
	POP	D
	PUSH	D
		CALL	@WRITE
		MVI	A,10
		CALL	PAUSE
		MVI	A,05AH
		CALL	@SCOL
	POP	D
	JMP	@WRITE
;
;--------------------------------ποστορξξοε ξαφατιε----------------
;	HL - ρώεκλα
;	DE - οτοβςαφαΰύαρ ποδπςοηςανννα
KEYM:	MVI	A,035H		; DCR M
	STA	KEY4
	XRA	A
	JMP	KEY0
;
KEYP:	MVI	A,034H		; INR M
	STA	KEY4
	MVI	A,164
;
KEY0:	STA	KEY3+1
	SHLD	KEY2+1
	XCHG
	SHLD	KEY5+1
KEY1:	CALL	PRNCUR1
	HLT
	HLT
	CALL	STRCUR
	CALL	INKEY
	LDA	KODKEY
	CPI	11111011B
	RNZ
KEY2:	LXI	H,0
KEY3:	MVI	A,0
	CMP	M
	RZ
KEY4:	NOP
KEY5:	CALL	0
	JMP	KEY1
;--------------------------------νεξΰ----------------
PRNMNU: MVI	A,05FH
	CALL	@SCOL
	LXI	D,MFREAD
	CALL	@WRITE
	LXI	D,MFSAVE
	CALL	@WRITE
	LXI	D,MKLOAD
	CALL	@WRITE
	LXI	D,MKSAVE
	CALL	@WRITE
	LXI	D,MEXIT
	JMP	@WRITE
;
;-------------------------------- + - ----------------
PRNMP:	MVI	A,05FH
	CALL	@SCOL
;
	LXI	D,MTKM
	CALL	@WRITE
	LXI	D,MTKP
	CALL	@WRITE
;
	LXI	D,MPKM
	CALL	@WRITE
	LXI	D,MPKP
	CALL	@WRITE
;
	LXI	D,MKKM
	CALL	@WRITE
	LXI	D,MKKP
	JMP	@WRITE
;--------------------------------λομ-χο----------------
COLTK:	MVI	A,05FH
	CALL	@SCOL
PRNTK:	LXI	D,MTKADR
	CALL	@WRITE
	LDA	@TREK
	JMP	@DECA
;
COLPK:	MVI	A,05FH
	CALL	@SCOL
PRNPK:	LXI	D,MPKADR
	CALL	@WRITE
	LDA	PKADR
	JMP	@DECA
;
COLKK:	MVI	A,05FH
	CALL	@SCOL
PRNKK:	LXI	D,MKKADR
	CALL	@WRITE
	LDA	KKADR
	JMP	@DECA
;--------------------------------αχτοςεχεςσ----------------
PRNREV: MVI	A,05FH
	CALL	@SCOL
	LXI	D,MRON
	CALL	@WRITE
	LXI	D,MROFF
	JMP	@WRITE
;----------------
CURSYX: DB	080H,080H
;
PKADR:	DB	0
KKADR:	DB	164
REVERS: DB	0FFH
;
MFREAD: DB	01BH,17,15,'ώΤΕΞΙΕ  ΖΙΜΨΝΑ',0
MFSAVE: DB	01BH,20,15,'ϊΑΠΙΣΨ  ΖΙΜΨΝΑ',0
MKLOAD: DB	01BH,23,15,'ϊΑΗΥΪΛΑ ΛΑΔΑ',0
MKSAVE: DB	01BH,26,15,'χΩΗΥΪΛΑ ΛΑΔΑ',0
MEXIT:	DB	01BH,29,17,'χΩΘΟΔ Χ δοσ',0
;
MTKM:	DB	01BH,3,2,'-',0
MTKADR: DB	01BH,3,4,0
MTKP:	DB	01BH,3,8,'+',0
;
MPKM:	DB	01BH,9,2,'-',0
MPKADR: DB	01BH,9,4,0
MPKP:	DB	01BH,9,8,'+',0
;
MKKM:	DB	01BH,15,2,'-',0
MKKADR: DB	01BH,15,4,0
MKKP:	DB	01BH,15,8,'+',0
;
MRON:	DB	01BH,20,2,'χΛΜ',0
MROFF:	DB	01BH,20,7,'οΤΛΜ',0
;
MSTOP:	DB	01BH,26,2,'σΤΟΠ - υσ',0
MCLS:	DB	01BH,26,2,'	    ',0
;
MERRORR:
	DB	01BH,25,3,'οΫΙΒΛΑ'
	DB	01BH,26,2,' ήΤΕΞΙΡ  '
	DB	01BH,27,2,'ΛΑΔΑ ',0
;
MERRORS:
	DB	01BH,25,3,'οΫΙΒΛΑ'
	DB	01BH,26,2,' ΪΑΠΙΣΙ  '
	DB	01BH,27,2,'ΛΑΔΑ ',0
;
	END
